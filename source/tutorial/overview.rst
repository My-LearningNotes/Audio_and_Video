音视频编解码技术概述
====================

音视频技术主要包括以下几点: **封装技术**\ , **视频压缩编码技术**\ 和\ **音频压缩编码技术**\ , 如果考虑到网络传输的话, 还包括\ **流媒体协议技术**\ . 

以用播放器播放一个网络上的视频文件为例, 需要经过以下几个步骤: **解协议**\ , **解封装**\ , **解码音视频**\ , **音视频同步**\ . 
如果播放本地文件则不需要解协议.

.. image:: images/play.jpg

*   **解协议的作用, 就是将流媒体协议的数据, 解析为标准的相应的封装格式数据.**

音视频在网络上传播时, 常常采用各种流媒体协议, 例如HTTP, RTMP, MMS等. 这些协议在传输\ **音视频数据(媒体数据)**\ 的同时, 也会传输一些\ **信令数据**\ . 
这些信令数据包括对播放的控制(播放, 暂停, 停止等), 或者对网络状态的描述等. 
解协议的过程中会去除掉信令数据而只保留音视频数据. 

例如, 采用RTMP协议传输的数据, 经过解协议操作后, 输出FLV格式的数据.

*   **解封装的作用, 就是将输入的封装格式的数据, 分离成为音频流压缩编码数据和视频流压缩编码数据.**

**封装格式**\ 种类很多, 例如MP4, MKV, RMVB, TS, FLV, AVI等, **它的作用就是将已经压缩编码的音频数据和视频数据按照一定的格式放到一起.**

例如, FLV格式的数据, 经过解封装后, 输出H.264编码的视频码流和AAC编码的音频码流.

*   **解码的作用, 就是将音频/视频压缩编码数据, 解码成为非压缩的音频/视频数据.**

音频的压缩编码标准包含AAC, MP3, AC-3等, 视频的压缩编码标准包含H.264, MEPG-2, VC-1等. 
解码是整个系统中最重要也是最复杂的一个环节. 
通过解码, 压缩编码的音频数据输出为非压缩的音频采样数据, 例如PCM数据; 压缩编码的视频数据输出成为非压缩的颜色数据, 例如YUV420P, RGB等.

*   **音视频同步**\ 的作用, 就是根据解封装模块处理过程中获取到的参数信息, 同步解码出来的音频数据和视频数据, 并将音频数据和视频数据推送至系统的声卡和显卡播放出来.


流媒体协议
----------

**流媒体协议是服务器与客户端之间网络通信遵循的规定.**

.. table:: 主要流媒体协议一览

    =========== =========== ========
    名称        传输层协议  使用领域
    RTSP+RTP    TCP/UDP     IPTV
    RTMP        TCP         网络直播
    HTTP        TCP         网络点播
    =========== =========== ========

现有的网络音视频服务主要包括两种方式: **点播**\ 和\ **直播**\ .

点播意即根据用户的需要播放相应的视频节目. 
直播意即将音视频内容实时发送给用户.

直播服务普遍采用RTMP作为流媒体协议, FLV作为封装格式, H.264作为视频编码格式, AAC作为音频编码格式. 
FLV是RTMP使用的封装格式, H.264是当今实际应用中编码效率最高的视频编码标准, AAC则是当今实际应用中编码效率最高的音频编码标准.

点播服务普遍采用了HTTP作为流媒体协议, H.264作为视频编码格式, AAC作为音频编码格式. 
采用HTTP作为点播协议有以下两点优势: 一方面, HTTP是基于TCP协议的应用层协议, 媒体传输过程中不会出现丢包等现象, 从而保证了视频的质量; 
另一方面, HTTP被绝大部分的Web服务器支持, 因而流媒体服务机构不必再投资购买额外的流媒体服务器, 从而节约了开支. 
点播服务采用的封装格式有多种: MP4, FLV, F4V等, 它们之间的区别不是很大.


封装格式
--------

**封装格式的主要作用是把音频码流和视频码流按照一定的格式存储在一个文件中.**

.. table:: 主要封装格式一览

    ==== ====== ================================ =======================================
    名称 流媒体 支持的视频编码                   支持的音频编码格式
    AVI  不支持 几乎所有格式                     几乎所有格式
    MP4  支持   MPEG-2, MPEG-4, H.264, H.264等   AAC, MPEG-1 Layers I, II, III, AC-3等
    TS   支持   MPEG-1, MPEG-2, MPEG-4, H.264等  MPEG-1 Layers I, II, III, AAC
    FLV  支持   Sorenson, VP6, H.264             MP3, ADPCM, Linear PCM, AAC等
    MKV  支持   几乎所有格式                     几乎所有格式
    RMVB 支持   RealVideo 8, 9, 10               AAC, Cook Codec, RealAudio Lossless
    ==== ====== ================================ =======================================

由表可见, 除了AVI之外, 其它封装格式都支持流媒体, 即可以"边下边播". 
有些格式更"万能一些, 支持的音视频编码标准多一些, 比如MKV; 而有些格式则支持的相对较少, 比如说RMVB.


视频编码
--------

视频编码的主要作用是将视频像素数据(RGB, YUV等)压缩成为视频码流, 从而降低视频的数据量. 
如果视频不经过压缩编码的话, 体积通常是非常大的, 一部电影可能就要上百G的空间. 
视频编码是音视频技术中最重要的技术之一. 
视频码流的数据量占了音视频总数据量的绝大部分. 
高效率的视频编码在同等的码率下, 可以获得更高的视频质量. 

.. table:: 主要视频编码一览

    ============== =========
    名称           推出时间
    HEVC(H.265)    2013
    H.264          2003
    MPEG-4         2001
    MPEG-2         1994
    VP9            2013
    VP8            2008
    VC-1           2006
    ============== =========

 
主流编码标准
~~~~~~~~~~~~

H.264仅仅是一个编码标准, 而不是一个具体的编码器, H.264只是给编码器的实现提供参照用的. 
基于H.264标准的编码器有很多. 实际中使用最多的就是x264了, 性能强悍(超过了很多商业编码器), 而且开源.

Google推出的VP8属于和H.264同一时代的标准. 
总体而言, VP8比H.264要稍微差一点.

此外, 我国还推出了自己的国产标准AVS, 性能也不错, 但目前比H.264还是要稍微逊色一点.


下一代编码标准
~~~~~~~~~~~~~~

下一代的编解码标准就要数HEVC(H.265)和VP9了. 
VP9是Google继VP8之后推出的新一代标准, VP9和HEVC相比, 要稍微逊色一些. 


音频编码
--------

音频编码的主要作用是将音频采样数据(PCM等)压缩成为音频码流, 从而降低音频的数据量. 
音频编码也是网络音视频技术中一个重要的技术, 但是一般情况下音频的数据量要远远小于视频的数据量, 
因而即使使用稍微落后的音频编码标准, 而导致音频数据量有所增加, 也不会对音视频的总数据量产生太大的影响. 
高效率的音频编码在同等的码率下, 可以获得更高的音质. 

.. table:: 主要音频编码一览

    ===== ========
    名称  推出时间
    AAC   1997
    AC-3  1992
    MP3   1993
    WMA   1999
    ===== ========

近年来并未推出新的音频编码方案, 可见音频编码技术已经基本可以满足人们的需要.

******

原文: `[总结]视音频编解码码技术零基础学习方法 <https://blog.csdn.net/leixiaohua1020/article/details/18893769>`_

