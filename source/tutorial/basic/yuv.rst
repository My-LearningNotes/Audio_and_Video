YUV
===

YUV是一种亮度与色度分离的颜色空间.

    * Y: 亮度, 就是灰度值. 除了表示亮度信号外, 还含有较多的绿色通道量;
    * U: 蓝色通道与亮度的差值;
    * V: 红色通道与亮度的差值.

采用YUV有什么优势呢?

    人眼对亮度敏感, 对色度不敏感, 因此减少部分UV的数据量, 人眼也无法感知出来, 
    这样就可以通过压缩UV的分辨率, 在不影响观感的前提下, 减少数据量.


YUV的采样格式
-------------

由于人眼对色度敏感度低, 所以可以省略一些色度信息, 即亮度共有一些色度信息, 从而减少数据量.

YUV的采样格式主要有: YUV444, YUV422, YUV411, YUV420.

* YUV444

Y, U和V按4:4:4的比例采样, 每一个Y对应一组UV分量.

YUV三个信道的采样率相同, 因此在生成的图像里, 每个像素的三个分量信息完整(每个分量通常8bits), 经过8比特量化后, 未经压缩的每个像素占用3个字节.

Example:

.. code-block::

    # 四个像素
    [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]

    # 采样后的码流
    Y0 U0 V0 Y1 U1 V1 Y2 U2 V2 Y3 U3 V3

    # 映射的像素
    [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]

* YUV422

Y, U和V按4:2:2的比例采样, 每个色差信道的采样率是亮度信道的一半, 所以水平方向的色度采样率只是4:4:4的一半. 
对非压缩的8比特量化的图像来说, 每个由两个水平方向相邻的像素组成的宏像素需要占用4个字节.

Example:

.. code-block::

    # 四个像素
    [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]

    # 采样后的码流
    Y0 U0 Y1 V1 Y2 U2 Y3 V3

    # 映射的像素点
    [Y0 U0 V1] [Y1 U0 V1] [Y2 U2 V3] [Y3 U2 V3]

* YUV411

Y, U和V按照4:1:1的比例采样, 对非压缩的8bit量化的视频来说, 每个由4个水平方向相邻的像素组成的宏像素需要占用6个字节.

Example:

.. code-block::

    # 四个像素
    [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]

    # 采样后的码流
    Y0 U0 Y1 Y2 V2 Y3

    # 映射的像素点
    [Y0 U0 V2] [Y1 U0 V2] [Y2 U0 V2] [Y3 U0 V2]

* YUV420

4:2:0并不意味着只有Y和U, 没有V. 
它是指对每行扫描线来说, 只有一种色度分量, 以2:1的比例采样; 
相邻的扫描行存储着不同的色度分量, 也就是说, 如果一行是4:2:0的话, 下一行就是4:0:2, 再下一行是4:2:0..., 以此类推. 
对于每个色度分量来说, 水平方向和竖直方向的采样率都是2:1, 所以可以说色度的采样率是4:1. 
对非压缩的8bit量化视频来说, 每个由2*2(2行2列)相邻像素组成的宏像素, 需要占用6个字节.

.. code-block::

    # 两行, 八个像素
    [Y0 U0 V0] [Y1 U1 V1] [Y2 U2 V2] [Y3 U3 V3]
    [Y4 U4 V4] [Y5 U5 V5] [Y6 U6 V6] [Y7 U7 V7]

    # 采样后的码流
    Y0 U0 Y1 Y2 U2 Y3
    Y4 V4 Y5 Y6 V6 Y7

    # 映射的像素点
    [Y0 U0 V4] [Y1 U0 V4] [Y2 U2 V6] [Y3 U2 V6]
    [Y4 U0 V4] [Y5 U0 v4] [Y6 U2 V6] [Y7 U2 V6]


YUV的存储格式
-------------

YUV的存储方式分为两大类: **planar**\ 和\ **packed**\ .

    * planar(平面格式): 先存储所有的Y, 紧接着存储所有的U, 最后是V, 就像是一个三维平面;
    * packed(打包格式): 每个像素点的Y, U, V连续交叉存储.

planar如下:

.. table::

    == == ==
    Y1 Y2 Y2
    U1 U2 U3
    V1 V2 V3
    == == ==

packed如下:
 
.. table::

    == == ==
    Y1 U1 V1
    Y2 U2 V2
    Y3 U3 V3
    == == ==

.. note::

    不过packed存储方式已经非常少用, 大部分视频都是采用planar存储方式.


RGB和YUV的换算
--------------

.. code-block::

    Y = 0.299R + 0.587G + 0.114B
    U = -0.147R - 0.289G + 0.436B
    V = 0.615R - 0.515G - 0.100B

    R = Y + 1.14V
    G = Y - 0.39U - 0.58V
    B = Y + 2.03U

